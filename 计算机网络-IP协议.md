## 目录

- [网际协议 IP (Internet Protocol)](#-----ip--internet-protocol-)
  * [一、分类的 IP 地址](#------ip---)
    + [1. IP 地址及其表示法](#1-ip--------)
    + [2. 常用的三种类别 IP 地址](#2---------ip---)
  * [二、ARP 地址解析协议](#--arp-------)
  * [三、IP 数据报格式](#--ip------)
- [划分子网和构造超网](#---------)
  * [一、划分子网](#------)
    + [1. 划分子网的基本思路](#1----------)
    + [2. 子网掩码](#2-----)



# 网际协议 IP (Internet Protocol)

**与 IP 协议配套使用的还有三个协议：**

1. 地址解析协议 ARP (Address Resolution Protocol)
2. 网际控制报文协议 ICMP (Internet Control Message Protocol)
3. 网际管理协议 IGMP (Internet Group Management Protocol)



## 一、分类的 IP 地址

### 1. IP 地址及其表示法

整个的互联网就是一个单一的、抽象的网络。IP 地址就是给互联网上的每一台主机
(或路由器)的每一个接口分配一个在全世界范围内是唯一的 32 位的标识符。IP 地址的结构使我们可以在互联网上很方便地进行寻址。IP 地址现在由互联网名字和数字分配机构ICANN (Internet Corporation for Assigned Names and Numbers)进行分配中。

**IP 地址的编址方法共经过了三个历史阶段：**

1. **分类的IP地址 ：** 这是最基本的编址方法，在 1981 年就通过了相应的标准协议。
2. **子网的划分：** 这是对最基本的编址方法的改进，其标准 RFC 950 在 1985 年通过。
3. **构成超网：** 这是比较新的无分类编址方法。1993 年提出后很快就得到推广应用。



这里先学习 **分类的 IP 地址** ，即将 IP 地址话分类若干个固定类，而每一类地址都有两个固定长度的字段组成：**网络号和主机号。** 网络号标志主机/路由器所连接的网络，主机号标志主机/路由器。

---



IP 地址都是 32 位的二进制，即 4 个字节；A类、B类、C类的主机号字段分别为3字节、2字节和1字节

![image-20200726213244637](https://github.com/OnlyThePiano/Notes/blob/master/images/image-20200726213244637.png)

**- 点分十进制记法：**

为了提高可读性，我们常常把 32 位的 IP 地址中的每 8 位插入一个空格(但在机器中并没有这样的空格)。为了便于书写，可用其等效的十进制数字表示，并且在这些数字之间加上一个点。这就叫做 **点分十进制记法** (dotted decimal notation)。

如下图所示。显然，128.11.3.31 比 10000000 00001011 0000011 00101111书写起来要方便得多。

![image-20200726213824691](https://github.com/OnlyThePiano/Notes/blob/master/images/image-20200726213824691.png) 

### 2. 常用的三种类别 IP 地址

**- A 类：**

**A 类地址可指派网络号 126 个 (即 2^7 - 2) ；** 减 2 的原因是：第一，网络号字段为全0 的 IP 地址是个保留地址，意思是 “本网络” ；第二，网络号为 127  (即 0111111) 保留作为本地软件 `环回测试(oopback test)` 本主机的进程之间的通信之用。

若主机发送一个目的地址为 `环回地址` (例如127.0.0.1) 的 IP 数据报，则本主机中的协议软件就处理数据报中的数据，而不会把数据报发送到任何网络。目的地址为环回地址的IP数据报永远不会出现在任何网络上，因为网络号为127的地址根本不是一个网络地址。

**A 类地址可指派主机号 2^24 - 2 个；** 减 2 的原因是：全 0 的主机号字段表示该 IP 地址是 “本主机” 所连接到的单个网络地址 (例如，一主机的IP地址为5.6.7.8，则该主机所在的网络地址就是5.0.0.0)，而全 1 的主机号字段表示该网络上的所有主机。



**- B 类：**

* **B 类地址可指派网络号 2^21 - 1；** 128.0.0.0 是不可指派的。
* **B 类地址可指派主机号 2^8 - 2 个；**



**- C 类：**

* **C 类地址可指派网络号 2^14 - 1；** 192.0.0.0 是不可指派的。
* **C 类地址可指派主机号 2^16 - 2 个；**



## 二、ARP 地址解析协议

> ARP (Address Resolution Protocol)

由于是 IP 协议使用了 ARP 协议，因此通常就把 ARP 协议划归网络层。但 ARP 协议的用途是为了从网络层使用的 IP 地址，解析出在数据链路层使用的硬件地址。

![image-20200726224226813](https://github.com/OnlyThePiano/Notes/blob/master/images/image-20200726224226813.png)



## 三、IP 数据报格式

![image-20200726224310738](https://github.com/OnlyThePiano/Notes/blob/master/images/image-20200726224310738.png)



# 划分子网和构造超网

## 一、划分子网

**- 前面 IP 地址的设计不够合理的地方：**

1. **IP 地址空间的利用率有时很低。 ** 

   每一个 A 类地址网络可连接的主机数超过 1000 万，而每一个 B 类地址网络可连接的主机数也超过 6 万。有的单位申请到了一个 B 类地址网络，但所连接的主机数并不多，可是又不愿意申请一个足够使用的 C 类地址，理由是考虑到今后可能的发展。所以，IP 地址被浪费。

2. **给每一个物理网络分配一个网络号会使路由表变得太大因而使网络性能变坏。 ** 

   每一个路由器都应当能够从 **路由表** 查出应怎样到达其他网络的下一跳路由器。因此，互联网中的网络数越多，路由器的路由表的项目数也就越多。这样，即使我们拥有足够多的 IP 地址资源可以给每一个物理网络分配一个网络号，也会导致路由器的路由表中的项目数过多。这不仅增加了路由器的成本(需要更多的存储空间)，而且使查找路由时耗费更多的时间，同时也使路由器之间定期交换的路由信息急剧增加，因而使路由器和整个互联网的性能都下降了。

3. **两级 IP 地址不够灵活。** 

   有时情况紧急，一个单位需要在新的地点马上开通一个新的网络。但是在申请到一个新的 IP 地址之前，新增加的网络是不可能连接到互联网上工作的。我们希望有一种方法，使一个单位能随时灵活地增加本单位的网络，而不必事先到互联网管理机构去申请新的网络号。原来的两级 IP 地址无法做到这一 点。
   为解决上述问题，从1985年起在IP地址中又增加了一个 “子网号字段” ，使两级IP 地址变成为三级 IP 地址，这种做法叫做 **划分子网** 或 **子网寻址** 或 **子网路由选择** 。划分子网已成为互联网的正式标准协议。

---



下面详细介绍子网是怎么划分的。

### 1. 划分子网的基本思路

**（1）** 一个拥有许多物理网络的单位，可将所属的物理网络划分为若干个子网 (subnet) 。划分子网纯属一个单位内部的事情。本单位以外的网络看不见这个网络是由多少个子网组成，因为这个 **单位** 对外仍然表现为一个网络。

**（2）** 划分子网的方法是 **从网络的主机号借用若干位作为 子网号(subnet-id)** ，当然主机号也就相应减少了同样的位数。三级 IP 地址：**网络号、子网号和主机号** 。

**（3）** 凡是从其他网络发送给本单位某台主机的 IP 数据报，仍然是根据 IP 数据报的目的网络号找到连接在本单位网络上的路由器。但此路由器在收到 IP 数据报后，再按目的网络号和子网号找到目的子网，把 IP 数据报交付目的主机。

![image-20200726232151456](https://github.com/OnlyThePiano/Notes/blob/master/images/image-20200726232151456.png)



### 2. 子网掩码

**假定有一个数据报 (其目的地址是 145.13.3.10) 已经到达了路由器 R1。那么这个路由器如何把它转发到子网 145.13.3.0 呢 ?** 

答：因为 32 位的 IP 地址本身以及数据报的首部都没有包含任何有关子网划分的信息。所以无法看出该网络是否进行了子网划分；因此必须另外想办法，这就是使用 **子网掩码 (subnet mask). ** 

子网掩码（以 145.13.3.10 为例）如下图所示：

![image-20200726233135988](https://github.com/OnlyThePiano/Notes/blob/master/images/image-20200726233135988.png)

看上图，**(e)** 表示 R1 把三级 IP 地址的子网掩码和收到的数据报的目的 IP地址145.13.3.10 逐位相 “与” (AND) ，得出了所要找的子网的 **网络地址** 145.13.3.0 。（IP 地址= 网络地址 + 主机地址）

**使用 子网掩码的好处就是：** 不管网络有没有划分子网，只要把子网掩码和 IP 地址进行逐位的 “与” 运算(AND)，就立即得出网络地址来。这样在路由器处理到来的分组时就可采用同样的算法。



**- 默认子网掩码：**

如果一个网络不划分子网，那么该网络的子网掩码就使用默认子网掩码。如下图所示：

![image-20200726235851005](https://github.com/OnlyThePiano/Notes/blob/master/images/image-20200726235851005.png)



