## 目录

- [一、物理层](#-----)
- [二、数据链路层](#-------)
  * [1. 成帧](#1---)
  * [2. 差错控制和纠正](#2--------)
- [三、网络层](#-----)
  * [Internet 的网络层](#internet-----)
  * [Ipv4 (Internet Protocol Version 4)](#ipv4--internet-protocol-version-4-)
- [四、运输层](#-----)
  * [1. 运输层主要使用以下两种协议:](#1---------------)
  * [2. 运输的端口](#2------)
  * [3. UDP 和 TCP 协议](#3-udp---tcp---)
- [四、应用层](#-----)
  * [1. 域名系统DNS (Domain Name System)](#1-----dns--domain-name-system-)
  * [2. FTP 和 HTTP 协议](#2-ftp---http---)

## 一、物理层

在物理层上所传送的数据单位是比特。 **物理层(physical layer)的作用是实现相邻计算机节点之间比特流的透明传送，尽可能屏蔽掉具体传输介质和物理设备的差异。** 使其上面的数据链路层不必考虑网络的具体传输介质是什么。“透明传送比特流” 表示经实际电路传送后的比特流没有发生变化，对传送的比特流来说，这个电路好像是看不见的。



## 二、数据链路层

物理层只关注单个比特的传输，机器 A 把比特放到线路上，然后机器 B 将这些比特取下来；不幸的是，通信线路偶尔也会出错、它们只有有限的传输速率、比特的发送时间和接收时间之间存在一个非零的延迟。

**所以数据链路层要完成的功能有如下：**

1. 向网络层提供一个定义良好的服务接口；
2. 处理传输错误；
3. 调节数据流，确保慢速的接收方不会被快速的发送方淹没。



![image-20200726083200934](https://github.com/OnlyThePiano/Notes/blob/master/images/image-20200726083200934.png)



**注意，数据链路和链路不是同一回事。** 

>* 链路 (link) 就是从一个结点到相邻结点的一段物理线路(有线或无线)，而中间没有任何其他的交换结点。在进行数据通信时，两台计算机之间的通信路径往往要经过许多段这样的链路。可见链路只是一条路径的组成部分。
>* 数据链路 (data link) 则是另一个概念。因为当需要在一条线路上传送数据时，除了必须有一条物理线路外，还必须有一些必要的通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了 `数据链路` 。现在最常用的方法是使用 `网络适配器` ( 既有硬件，也包括软件) 来实现这些协议。一般的适配器都包括了数据链路层和物理层这两层的功能。



### 1. 成帧

将比特流拆分成多个离散的帧，为每个帧计算一个校验和，并将校验和放到帧中一起传输，当到达目标机器时，重新计算校验和，如果重新计算的校验和和帧中的校验和不同，则数据链路层知道传输过程中产生了错误，它将会采取措施处理错误。每一帧包括数据和必要的控制信息（如同步信息，地址信息，差错控制等）。



### 2. 差错控制和纠正

**传输错误时普遍存在的，那如何处理传输错误呢 ？**

答：在发送的数据中加入冗余信息；一种是在每一个被发送的数据块中包含足够多的冗余信息，以便接收方能判断出被发送的数据是什么，也就是 **纠错码** ；另一种是让这些冗余信息只能让接收方推断是否发生了错误，也就是 **检错码** 。

**1. 纠错码**

**2. 检错码：**

* 奇偶
* 校验和
* 循环冗余校验 (CRC)



## 三、网络层

数据链路层只是将帧从线路的一边传到另一边（处理了传输错误），而网络层是处理端到端的数据传输的最底层；为了将数据包送到接收方，可能沿途要经过许多跳 (hop) 中间路由器。

在计算机网络中进行通信的两个计算机之间可能会经过很多个数据链路，也可能还要经过很多通信子网。网络层的任务就是选择合适的网间路由和交换结点， 确保数据及时传送。



**怎么选择合适的网间路由和交换结点呢 ？**

答：通过路由算法。



**- 路由算法**

1. 优先原则
2. 最短路径算法
3. 泛洪算法
4. 距离矢量算法



### Internet 的网络层

互联网是由大量的异构（heterogeneous）网络通过路由器（router）相互连接起来的。互联网使用的网络层协议是无连接的网际协议（Internet Protocol）和许多路由选择协议，因此互联网的网络层也叫做 **网际层** 或 **IP层**。

![image-20200726081550091](https://github.com/OnlyThePiano/Notes/blob/master/images/image-20200726081550091.png)

可以看出，许多计算机网络通过路由器进行互连。由于参加互连的计算机网络使用了相同的网际协议 IP (Internet Protocol)，因此可以看作是一个 **虚拟的互连网络 (internet)** 。

>**虚拟互连网络** ，也就是逻辑互连网络，它的意思就是互连起来的各种物理网络的异构性本来是客观存在的，但是我们利用 IP 协议就可以使这些性能各异的网络在网络层上看起来好像是一个统一的网络。这种使用 IP 协议的虚拟互连网络可简称为 **IP 网  (IP 网是虚拟的，但平常不必每次都强调“虚拟”二字 )** 。
>
>使用 IP 网的好处是：当IP网上的主机进行通信时，就好像在一个单个网络上通信一样，它们看不见互连的各网络的具体异构细节 (如具体的编址方案、路由选择协议，等等)。如果在这种覆盖全球的 IP 网的上层使用 TCP 协议，那么就是现在的 **互联网 (Internet)** 。



### Ipv4 (Internet Protocol Version 4)

1. 前缀 (prefix)
2. 子网 (subnet)
3. CIDR-无类域间路由
4. 分类和特殊寻址
5. 网络地址转换 (NAT)

更详细看 [计算机网络-IP协议](https://github.com/OnlyThePiano/Notes/blob/master/计算机网络-IP协议.md)



## 四、运输层

IP 协议虽然能把分组送到目的主机，但是这个分组还停留在主机的网络层而没有交付主机中的应用进程。从运输层的角度看，通信的真正端点并不是主机而是主机中的进程。也就是说，端到端的通信是应用进程之间的通信。

![image-20200726081235658](https://github.com/OnlyThePiano/Notes/blob/master/images/image-20200726081235658.png)

>**“逻辑通信”** 的意思是：从应用层来看，只要把应用层报文交给下面的运输层，运输层就可以把这报文传送到对方的运输层(哪怕双方相距很远，例如几千公里)，好像这种通信就是沿水平方向直接传送数据。但事实上这两个运输层之间并没有一条水平方向的物理连接。数据的传送是沿着图中的虚线方向(经过多个层次)传送的。



### 1. 运输层主要使用以下两种协议:

1. **传输控制协议 TCP**（Transmission Control Protocol）：提供**面向连接**的，**可靠的**数据传输服务。
2. **用户数据协议 UDP**（User Datagram Protocol）：提供**无连接**的，尽最大努力的数据传输服务（**不保证数据传输的可靠性**）。

### 2. 运输的端口

运输层的两个重要功能：复用和分用。应用层所有的应用进程都可以通过运输层再传送到 IP层(网络层)，这就是复用。运输层从 IP层 收到发送给各应用进程的数据后，必须分别交付指明的各应用进程，这就是分用。

显然，给应用层的每个应用进程赋予一个非常明确的标志是至关重要的。



**那么用什么去这个标志每个进程呢 ？**

答：我们知道，在单个计算机中的进程是用 `进程标识符` 来标志的。但是在互联网环境下，用计算机操作系统所指派的这种进程标识符来标志运行在应用层的各种应用进程则是不行的。这是因为在互联网上使用的计算机的操作系统种类很多，而不同的操作系统又使用不同格式的 `进程标识符` 。为了使运行不同操作系统的计算机的应用进程能够互相通信，就必须用统一的方法 (而这种方法必须与特定操作系统无关) 对 TCP/IP 体系的应用进程进行标志。

解决这个问题的方法，在运输层使用 `协议端口号(protocol port number) `，或通常简称为 `端口(port)`。这就是说，虽然通信的终点是应用进程，但只要把所传送的报文交到目的主机的某个合适的目的端口，剩下的工作 (即最后交付目的进程) 就由 TCP 或 UD P来完成。

**注意，这里的端口是软件端口，软件端口和物理端口是不同的。**

> 这种在协议栈层间的抽象的协议端口是软件端口，和路由器或交换机上的硬件端口是完全不同的概念。硬件端口是不同硬件设备进行交互的接口，而软件端口是应用层的各种协议进程与运输实体进行层间交互的一种地址。不同的系统具体实现端口的方法可以
> 是不同的 (取决于系统使用的操作系统)。



**- 端口号：**

* 16 位
* 服务器端口号 (系统端口号和登记端口号)
* 客户端端口号 (短暂端口号)



### 3. UDP 和 TCP 协议

[计算机网络-UDP和TCP协议](https://github.com/OnlyThePiano/Notes/blob/master/计算机网络-UDP和TCP协议.md)



## 四、应用层

应用层(application-layer）的任务是通过应用进程间的交互来完成特定网络应用。应用层协议定义的是应用进程（进程：主机中正在运行的程序）间的通信和交互的规则。对于不同的网络应用需要不同的应用层协议。



### 1. 域名系统DNS (Domain Name System)

互联网的域名空间如下，从理论上讲，可以让每一级的域名都有-一个相对应的域名服务器，使所有的域名服务器构成和其相对应的 “域名服务器树” 的结构。但这样做会使域名服务器的数量太多，使域名系统的运行效率降低。因此 DNS 就采用划分区的办法来解决这个问题。

![image-20200726091521943](https://github.com/OnlyThePiano/Notes/blob/master/images/image-20200726091521943.png)



把一个服务器所负责管辖的范围叫做 `区(zone)` 。各单位根据具体情况来划分自己管辖范围的区。但在一个区中的所有节点必须是能够连通的。每一个区设置相应的 `权限域名服务器(authoritative name server)`， 用来保存该区中的所有主机的域名到 IP 地址的映
射。总之，DNS服务器的管辖范围不是以“域”为单位，而是以“区”为单位。

区是“域”的子集，如下图所示。

![image-20200726091925505](https://github.com/OnlyThePiano/Notes/blob/master/images/image-20200726091925505.png)

根据域名服务器所起的作用，把域名服务器分为了以下四种：

1. **根域名服务器：** 是最高层次的域名服务器，所有的根域名服务器都知道所有的顶级域名服务器的域名和 IP 地址。虽然根域名只有 13 个，但是目前全世界已有 588 个地点安装了根域名服务器。事实上，负责运营根域名服务器的公司在美国，分布在世界各地的域名服务器是 “镜像跟服务器” 。
2. **顶级服务器：** 负责管理在该顶级域名服务器注册的所有二级域名。
3. **权限域名服务器：** 负责一个区的域名服务器。当一个权限域名服务器还不能给出最后的查询回答时，就会告诉发出查询请求的DNS客户，下一步应当找哪一个权限域名服务器。如上图 (b) 中，区abc.com 和 区y.abc.com 各设有一个权限域名服务器。
4. **本地域名服务器：** 它不属于域名服务器层次结构，但它对域名系统却非常重要。当一台主机发出DNS查询请求时，这个查询请求报文就发送给本地域名服务器。每一个互联网服务提供者ISP， 或一个大学，甚至一个大学里的系，都可以拥有一个本地域名服务器，有时也称为默认域名服务器。



**域名解析的过程有两种，递归查询和迭代查询。**

![image-20200726093859614](https://github.com/OnlyThePiano/Notes/blob/master/images/image-20200726093859614.png)



**第一** ，主机向本地域名服务器的查询一般都是采用 `递归查询(recursive query)`。如果主机所询问的本地域名服务器不知道被查询域名的 IP 地址，那么本地域名服务器就以 DNS 客户的身份，向其他根域名服务器继续发出查询请求报文(即替该主机继续查询)，而不是让该主机自己进行下一步的查询。因此，递归查询返回的查询结果或者是所要查询的 IP地址，或者是报错，表示无法查询到所需的IP地址。

**第二** ，本地域名服务器向根域名服务器的查询通常是采用 `迭代查询(iterativequery)`。当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地域名服务器：“你下一步应当向哪一个域名服务器进行查询” 。然后让本地域名服务器进行后续的查询 (而不是替本地域名服务器进行后续的查询)。

**根域名服务器** 通常是把自己知道的顶级域名服务器的 IP 地址告诉本地域名服务器，让本地域名服务器再向顶级域名服务器查询。**顶级域名服务器** 在收到本地域名服务器的查询请求后，要么给出所要查询的 IP 地址，要么告诉本地域名服务器下一步应当向哪一个权限域名服务器进行查询，本地域名服务器就这样进行迭代查询。最后，知道了所要解析的域名的IP地址，然后把这个结果返回给发起查询的主机。当然，本地域名服务器也可以采用递归查询，这取决于最初的查询请求报文的设置是要求使用哪一种查询方式。



### 2. FTP 和 HTTP 协议

[计算机网络-FTP和HTTP协议](https://github.com/OnlyThePiano/Notes/blob/master/计算机网络-FTP和HTTP协议.md)